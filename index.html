<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity Web Player | Rugartian Project</title>
</head>

<body style="text-align: center; padding: 0; border: 0; margin: 0;">
  <canvas id="unity-canvas" width="960" height="600" tabindex="-1" style="width: 960px; height: 600px; background: #CCCCCC;"></canvas>

  <script src="Build/build.loader.js"></script>

  <script>
    let unityInstance = null; // Store the Unity instance globally

    // Initialize the Unity WebGL instance
    createUnityInstance(document.querySelector("#unity-canvas"), {
      dataUrl: "Build/build.data.unityweb",
      frameworkUrl: "Build/build.framework.js.unityweb",
      codeUrl: "Build/build.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "Rugartian Project",
      productVersion: "0.1.0",
    }).then((instance) => {
      console.log("Unity instance is ready!");
      unityInstance = instance; // Store instance globally
      initializeUnityCommunication(); // Start listening for messages
    }).catch((error) => {
      console.error("Unity failed to load:", error);
    });

    // Message listener function
    function initializeUnityCommunication() {
      console.log("Initializing communication...");

      window.addEventListener("message", function(event) {
        console.log("Received message:", event.data);

        // Ensure the message is from a trusted origin (uncomment and adjust for your needs)
        // if (event.origin !== "https://rahulkumarrugartisan.github.io/Website_PDP") return;

        if (unityInstance) {
          // Send the message to Unity
          unityInstance.SendMessage('WebGLDataReciver', 'SendMessageFromJS', event.data);
          console.log("Message sent to Unity:", event.data);
        } else {
          console.error("Unity instance not found.");
        }
      });
    }
  </script>

</body>
</html>
